!function(t){function i(t,i,e){var s=parseInt(t.css("top"),10);if("left"==i){var a="-"+this.image_wrapper_height+"px";t.css("top",this.image_wrapper_height+"px")}else{var a=this.image_wrapper_height+"px";t.css("top","-"+this.image_wrapper_height+"px")}return e&&(e.css("bottom","-"+e[0].offsetHeight+"px"),e.animate({bottom:0},2*this.settings.animation_speed)),this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},2*this.settings.animation_speed),{old_image:{top:a},new_image:{top:s}}}function e(t,i,e){var s=parseInt(t.css("left"),10);if("left"==i){var a="-"+this.image_wrapper_width+"px";t.css("left",this.image_wrapper_width+"px")}else{var a=this.image_wrapper_width+"px";t.css("left","-"+this.image_wrapper_width+"px")}return e&&(e.css("bottom","-"+e[0].offsetHeight+"px"),e.animate({bottom:0},2*this.settings.animation_speed)),this.current_description&&this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},2*this.settings.animation_speed),{old_image:{left:a},new_image:{left:s}}}function s(t,i,e){var s=t.width(),a=t.height(),n=parseInt(t.css("left"),10),r=parseInt(t.css("top"),10);return t.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2}),{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:s,height:a,top:r,left:n}}}function a(t,i,e){return t.css("opacity",0),{old_image:{opacity:0},new_image:{opacity:1}}}function n(t,i,e){return t.css("opacity",0),{old_image:{opacity:0},new_image:{opacity:1},speed:0}}function r(t,i){this.init(t,i)}function h(t,i){this.init(t,i)}t.fn.adGallery=function(i){var e={loader_image:PATH+"_images/ad-gallery/loader.gif",start_at_index:0,description_wrapper:!1,thumb_opacity:.7,animate_first_image:!1,animation_speed:400,width:!1,height:!1,display_next_and_prev:!0,display_back_and_forward:!0,scroll_jump:0,slideshow:{enable:!0,autostart:!1,speed:5e3,start_label:"Start",stop_label:"Stop",stop_on_scroll:!0,countdown_prefix:"(",countdown_sufix:")",onStart:!1,onStop:!1},effect:"slide-hori",enable_keyboard_move:!0,cycle:!0,callbacks:{init:!1,afterImageVisible:!1,beforeImageVisible:!1}},s=t.extend(!1,e,i);i&&i.slideshow&&(s.slideshow=t.extend(!1,e.slideshow,i.slideshow)),s.slideshow.enable||(s.slideshow.autostart=!1);var a=[];return t(this).each(function(){var t=new r(this,s);a[a.length]=t}),a},r.prototype={wrapper:!1,image_wrapper:!1,gallery_info:!1,nav:!1,loader:!1,preloads:!1,thumbs_wrapper:!1,scroll_back:!1,scroll_forward:!1,next_link:!1,prev_link:!1,slideshow:!1,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:!1,current_description:!1,nav_display_width:0,settings:!1,images:!1,in_transition:!1,animations:!1,init:function(i,e){var s=this;this.wrapper=t(i),this.settings=e,this.setupElements(),this.setupAnimations(),this.settings.width?(this.image_wrapper_width=this.settings.width,this.image_wrapper.width(this.settings.width),this.wrapper.width(this.settings.width)):this.image_wrapper_width=this.image_wrapper.width(),this.settings.height?(this.image_wrapper_height=this.settings.height,this.image_wrapper.height(this.settings.height)):this.image_wrapper_height=this.image_wrapper.height(),this.nav_display_width=this.nav.width(),this.current_index=0,this.current_image=!1,this.current_description=!1,this.in_transition=!1,this.findImages(),this.settings.display_next_and_prev&&this.initNextAndPrev();var a=function(t){return s.nextImage(t)};this.slideshow=new h(a,this.settings.slideshow),this.controls.append(this.slideshow.create()),this.settings.slideshow.enable?this.slideshow.enable():this.slideshow.disable(),this.settings.display_back_and_forward&&this.initBackAndForward(),this.settings.enable_keyboard_move&&this.initKeyEvents();var n=parseInt(this.settings.start_at_index,10);window.location.hash&&0===window.location.hash.indexOf("#ad-image")&&(n=window.location.hash.replace(/[^0-9]+/g,""),1*n!=n&&(n=this.settings.start_at_index)),this.loading(!0),this.showImage(n,function(){s.settings.slideshow.autostart&&(s.preloadImage(n+1),s.slideshow.start())}),this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":i,"slide-hori":e,resize:s,fade:a,none:n}},setupElements:function(){this.controls=this.wrapper.find(".ad-controls"),this.gallery_info=t('<p class="ad-info"></p>'),this.controls.append(this.gallery_info),this.image_wrapper=this.wrapper.find(".ad-image-wrapper"),this.image_wrapper.empty(),this.nav=this.wrapper.find(".ad-nav"),this.thumbs_wrapper=this.nav.find(".ad-thumbs"),this.preloads=t('<div class="ad-preloads"></div>'),this.loader=t('<img class="ad-loader" src="'+this.settings.loader_image+'">'),this.image_wrapper.append(this.loader),this.loader.hide(),t(document.body).append(this.preloads)},loading:function(t){t?this.loader.show():this.loader.hide()},addAnimation:function(i,e){t.isFunction(e)&&(this.animations[i]=e)},findImages:function(){var i=this;this.images=[];var e=0,s=0,a=this.thumbs_wrapper.find("a"),n=a.length;this.settings.thumb_opacity<1&&a.find("img").css("opacity",this.settings.thumb_opacity),a.each(function(a){var n=t(this),r=n.attr("href"),h=n.find("img");i.isImageLoaded(h[0])?(e+=h[0].parentNode.parentNode.offsetWidth,s++):h.load(function(){e+=this.parentNode.parentNode.offsetWidth,s++}),n.addClass("ad-thumb"+a),n.click(function(){return i.showImage(a),i.slideshow.stop(),!1}).hover(function(){!t(this).is(".ad-active")&&i.settings.thumb_opacity<1&&t(this).find("img").fadeTo(300,1),i.preloadImage(a)},function(){!t(this).is(".ad-active")&&i.settings.thumb_opacity<1&&t(this).find("img").fadeTo(300,i.settings.thumb_opacity)});var n=!1;h.data("ad-link")?n=h.data("ad-link"):h.attr("longdesc")&&h.attr("longdesc").length&&(n=h.attr("longdesc"));var o=!1;h.data("ad-desc")?o=h.data("ad-desc"):h.attr("alt")&&h.attr("alt").length&&(o=h.attr("alt"));var d=!1;h.data("ad-title")?d=h.data("ad-title"):h.attr("title")&&h.attr("title").length&&(d=h.attr("title")),i.images[a]={thumb:h.attr("src"),image:r,error:!1,preloaded:!1,desc:o,title:d,size:!1,link:n}});var r=setInterval(function(){if(n==s){e-=100;var t=i.nav.find(".ad-thumb-list");t.css("width",e+"px");for(var a=1,h=t.height();201>a&&(t.css("width",e+a+"px"),h==t.height());)h=t.height(),a++;clearInterval(r)}},100)},initKeyEvents:function(){var i=this;t(document).keydown(function(t){39==t.keyCode?(i.nextImage(),i.slideshow.stop()):37==t.keyCode&&(i.prevImage(),i.slideshow.stop())})},initNextAndPrev:function(){this.next_link=t('<div class="ad-next"><div class="ad-next-image"></div></div>'),this.prev_link=t('<div class="ad-prev"><div class="ad-prev-image"></div></div>'),this.image_wrapper.append(this.next_link),this.image_wrapper.append(this.prev_link);var i=this;this.prev_link.add(this.next_link).mouseover(function(e){t(this).css("height",i.image_wrapper_height),t(this).find("div").show()}).mouseout(function(i){t(this).find("div").hide()}).click(function(){t(this).is(".ad-next")?(i.nextImage(),i.slideshow.stop()):(i.prevImage(),i.slideshow.stop())}).find("div").css("opacity",.7)},initBackAndForward:function(){var i=this;this.scroll_forward=t('<div class="ad-forward"></div>'),this.scroll_back=t('<div class="ad-back"></div>'),this.nav.append(this.scroll_forward),this.nav.prepend(this.scroll_back);var e=0,s=!1;t(this.scroll_back).add(this.scroll_forward).click(function(){var e=i.nav_display_width-50;if(i.settings.scroll_jump>0)var e=i.settings.scroll_jump;if(t(this).is(".ad-forward"))var s=i.thumbs_wrapper.scrollLeft()+e;else var s=i.thumbs_wrapper.scrollLeft()-e;return i.settings.slideshow.stop_on_scroll&&i.slideshow.stop(),i.thumbs_wrapper.animate({scrollLeft:s+"px"}),!1}).css("opacity",.6).hover(function(){var a="left";t(this).is(".ad-forward")&&(a="right"),s=setInterval(function(){e++,e>30&&i.settings.slideshow.stop_on_scroll&&i.slideshow.stop();var t=i.thumbs_wrapper.scrollLeft()+1;"left"==a&&(t=i.thumbs_wrapper.scrollLeft()-1),i.thumbs_wrapper.scrollLeft(t)},10),t(this).css("opacity",1)},function(){e=0,clearInterval(s),t(this).css("opacity",.6)})},_afterShow:function(){this.gallery_info.html(this.current_index+1+" / "+this.images.length),this.settings.cycle||(this.prev_link.show().css("height",this.image_wrapper_height),this.next_link.show().css("height",this.image_wrapper_height),this.current_index==this.images.length-1&&this.next_link.hide(),0==this.current_index&&this.prev_link.hide()),this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(t,i){if(i>this.image_wrapper_height){var e=t/i;i=this.image_wrapper_height,t=this.image_wrapper_height*e}if(t>this.image_wrapper_width){var e=i/t;t=this.image_wrapper_width,i=this.image_wrapper_width*e}return{width:t,height:i}},_centerImage:function(t,i,e){if(t.css("top","0px"),e<this.image_wrapper_height){var s=this.image_wrapper_height-e;t.css("top",s/2+"px")}if(t.css("left","0px"),i<this.image_wrapper_width){var s=this.image_wrapper_width-i;t.css("left",s/2+"px")}},_getDescription:function(i){var e=!1;if(i.desc.length||i.title.length){var s="";i.title.length&&(s='<strong class="ad-description-title">'+i.title+"</strong>");var e="";i.desc.length&&(e="<span>"+i.desc+"</span>"),e=t('<p class="ad-image-description">'+s+e+"</p>")}return e},showImage:function(t,i){if(this.images[t]&&!this.in_transition){var e=this,s=this.images[t];this.in_transition=!0,s.preloaded?this._showWhenLoaded(t,i):(this.loading(!0),this.preloadImage(t,function(){e.loading(!1),e._showWhenLoaded(t,i)}))}},_showWhenLoaded:function(i,e){if(this.images[i]){var s=this,a=this.images[i],n=t(document.createElement("div")).addClass("ad-image"),r=t(new Image).attr("src",a.image);if(a.link){var h=t('<a href="'+a.link+'" target="_blank"></a>');h.append(r),n.append(h)}else n.append(r);this.image_wrapper.prepend(n);var o=this._getContainedImageSize(a.size.width,a.size.height);r.attr("width",o.width),r.attr("height",o.height),n.css({width:o.width+"px",height:o.height+"px"}),this._centerImage(n,o.width,o.height);var d=this._getDescription(a,n);if(d)if(this.settings.description_wrapper)this.settings.description_wrapper.append(d);else{n.append(d);var l=o.width-parseInt(d.css("padding-left"),10)-parseInt(d.css("padding-right"),10);d.css("width",l+"px")}this.highLightThumb(this.nav.find(".ad-thumb"+i));var p="right";if(this.current_index<i&&(p="left"),this.fireCallback(this.settings.callbacks.beforeImageVisible),this.current_image||this.settings.animate_first_image){var c=this.settings.animation_speed,g="swing",_=this.animations[this.settings.effect].call(this,n,p,d);if("undefined"!=typeof _.speed&&(c=_.speed),"undefined"!=typeof _.easing&&(g=_.easing),this.current_image){var f=this.current_image,m=this.current_description;f.animate(_.old_image,c,g,function(){f.remove(),m&&m.remove()})}n.animate(_.new_image,c,g,function(){s.current_index=i,s.current_image=n,s.current_description=d,s.in_transition=!1,s._afterShow(),s.fireCallback(e)})}else this.current_index=i,this.current_image=n,s.current_description=d,this.in_transition=!1,s._afterShow(),this.fireCallback(e)}},nextIndex:function(){if(this.current_index==this.images.length-1){if(!this.settings.cycle)return!1;var t=0}else var t=this.current_index+1;return t},nextImage:function(t){var i=this.nextIndex();return i===!1?!1:(this.preloadImage(i+1),this.showImage(i,t),!0)},prevIndex:function(){if(0==this.current_index){if(!this.settings.cycle)return!1;var t=this.images.length-1}else var t=this.current_index-1;return t},prevImage:function(t){var i=this.prevIndex();return i===!1?!1:(this.preloadImage(i-1),this.showImage(i,t),!0)},preloadAll:function(){function t(){e<i.images.length&&(e++,i.preloadImage(e,t))}var i=this,e=0;i.preloadImage(e,t)},preloadImage:function(i,e){if(this.images[i]){var s=this.images[i];if(this.images[i].preloaded)this.fireCallback(e);else{var a=t(new Image);if(a.attr("src",s.image),this.isImageLoaded(a[0]))s.preloaded=!0,s.size={width:a[0].width,height:a[0].height},this.fireCallback(e);else{this.preloads.append(a);var n=this;a.load(function(){s.preloaded=!0,s.size={width:this.width,height:this.height},n.fireCallback(e)}).error(function(){s.error=!0,s.preloaded=!1,s.size=!1})}}}},isImageLoaded:function(t){return"undefined"==typeof t.complete||t.complete?"undefined"!=typeof t.naturalWidth&&0==t.naturalWidth?!1:!0:!1},highLightThumb:function(t){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active"),t.addClass("ad-active"),this.settings.thumb_opacity<1&&(this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity),t.find("img").fadeTo(300,1));var i=t[0].parentNode.offsetLeft;i-=this.nav_display_width/2-t[0].offsetWidth/2,this.thumbs_wrapper.animate({scrollLeft:i+"px"})},fireCallback:function(i){t.isFunction(i)&&i.call(this)}},h.prototype={start_link:!1,stop_link:!1,countdown:!1,controls:!1,settings:!1,nextimage_callback:!1,enabled:!1,running:!1,countdown_interval:!1,init:function(t,i){this.nextimage_callback=t,this.settings=i},create:function(){this.start_link=t('<span class="ad-slideshow-start">'+this.settings.start_label+"</span>"),this.stop_link=t('<span class="ad-slideshow-stop">'+this.settings.stop_label+"</span>"),this.countdown=t('<span class="ad-slideshow-countdown"></span>'),this.controls=t('<div class="ad-slideshow-controls"></div>'),this.controls.append(this.start_link).append(this.stop_link).append(this.countdown),this.countdown.hide();var i=this;return this.start_link.click(function(){i.start()}),this.stop_link.click(function(){i.stop()}),t(document).keydown(function(t){83==t.keyCode&&(i.running?i.stop():i.start())}),this.controls},disable:function(){this.enabled=!1,this.stop(),this.controls.hide()},enable:function(){this.enabled=!0,this.controls.show()},toggle:function(){this.enabled?this.disable():this.enable()},start:function(){if(this.running||!this.enabled)return!1;return this.running=!0,this.controls.addClass("ad-slideshow-running"),this._next(),this.fireCallback(this.settings.onStart),!0},stop:function(){return this.running?(this.running=!1,this.countdown.hide(),this.controls.removeClass("ad-slideshow-running"),clearInterval(this.countdown_interval),this.fireCallback(this.settings.onStop),!0):!1},_next:function(){var t=this,i=this.settings.countdown_prefix,e=this.settings.countdown_sufix;clearInterval(t.countdown_interval),this.countdown.show().html(i+this.settings.speed/1e3+e);var s=0;this.countdown_interval=setInterval(function(){if(s+=1e3,s>=t.settings.speed){var a=function(){t.running&&t._next(),s=0};t.nextimage_callback(a)||t.stop(),s=0}var n=parseInt(t.countdown.text().replace(/[^0-9]/g,""),10);n--,n>0&&t.countdown.html(i+n+e)},1e3)},fireCallback:function(i){t.isFunction(i)&&i.call(this)}}}(jQuery);